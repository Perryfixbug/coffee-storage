<%= form_with model: @order, url: orders_path, method: :post, data: { controller: "order-form", turbo: false }, class: "space-y-6" do |f| %>

  <!-- üîç T√¨m ƒë·∫°i l√Ω -->
  <div>
    <label class="block font-medium text-gray-700 mb-2">T√¨m ƒë·∫°i l√Ω</label>
    <div class="flex gap-2">
      <input type="text"
             placeholder="Nh·∫≠p ID ho·∫∑c t√™n ƒë·∫°i l√Ω..."
             class="border p-2 flex-1 rounded-md"
             data-order-form-target="agencyInput">
      <button type="button"
              class="bg-blue-600 text-white px-4 py-2 rounded-md"
              data-action="click->order-form#searchAgency">T√¨m</button>
    </div>

    <div class="mt-2 border rounded-md hidden"
         data-order-form-target="agencyResults"></div>

    <!-- Hi·ªÉn th·ªã ƒë·∫°i l√Ω ƒë√£ ch·ªçn -->
    <div class="mt-3 text-green-700 font-medium"
         data-order-form-target="selectedAgency"></div>

    <!-- Hidden field ƒë·ªÉ l∆∞u agency_id -->
    <%= f.hidden_field :agency_id, data: { order_form_target: "agencyHidden" } %>
  </div>

  <!-- üîç T√¨m s·∫£n ph·∫©m -->
  <div>
    <label class="block font-medium text-gray-700 mb-2">T√¨m s·∫£n ph·∫©m</label>
    <div class="flex gap-2">
      <input type="text"
             placeholder="Nh·∫≠p t√™n ho·∫∑c m√£ s·∫£n ph·∫©m..."
             class="border p-2 flex-1 rounded-md"
             data-order-form-target="productInput">
      <button type="button"
              class="bg-blue-600 text-white px-4 py-2 rounded-md"
              data-action="click->order-form#searchProduct">T√¨m</button>
    </div>

    <ul class="mt-2 border rounded-md hidden divide-y"
        data-order-form-target="productResults"></ul>
  </div>

  <!-- üßæ Danh s√°ch s·∫£n ph·∫©m ƒë√£ ch·ªçn -->
  <div>
    <h3 class="text-lg font-semibold mb-2">S·∫£n ph·∫©m ƒë√£ ch·ªçn</h3>
    <ul class="border rounded-md divide-y"
        data-order-form-target="selectedProducts"></ul>
  </div>

  <!-- Hidden nested fields ƒë·ªÉ g·ª≠i ordered_products -->
  <div data-order-form-target="hiddenFields">
    <% @order.ordered_products.each do |op| %>
      <%= f.fields_for :ordered_products, op do |of| %>
        <%= of.hidden_field :product_id %>
        <%= of.hidden_field :quantity %>
      <% end %>
    <% end %>
  </div>

  <!-- ‚úÖ Submit -->
  <%= f.submit "X√°c nh·∫≠n", 
        class: "bg-green-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-700" %>

<% end %>
