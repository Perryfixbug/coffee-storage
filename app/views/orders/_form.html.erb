<%= form_with model: @order,
              method: :post,
              data: { controller: "order-form", turbo: false },
              class: "space-y-8 bg-white border border-gray-200 rounded-lg p-6 w-[700px]" do |f| %>

  <!-- üß≠ Header -->
  <div class="flex items-center justify-between border-b pb-3">
    <h2 class="text-xl font-semibold text-gray-800">
      <%= @order.is_a?(ImportOrder) ? "T·∫°o phi·∫øu nh·∫≠p h√†ng" : "T·∫°o phi·∫øu xu·∫•t h√†ng" %>
    </h2>
    <span class="text-sm text-gray-500">Ng∆∞·ªùi t·∫°o: <%= current_user.fullname %></span>
  </div>

  <!-- üîç Ch·ªçn ƒë·∫°i l√Ω -->
  <div class="space-y-1">
    <label class="block text-gray-700 font-medium">T√¨m ƒë·∫°i l√Ω</label>
    <div class="relative">
      <input type="text"
             placeholder="Nh·∫≠p ID ho·∫∑c t√™n ƒë·∫°i l√Ω..."
             class="border border-gray-300 focus:border-blue-500 focus:ring-0 rounded-md w-full p-2 text-sm"
             data-order-form-target="agencyInput"
             data-action="input->order-form#searchAgency">

      <div class="absolute left-0 right-0 mt-1 hidden bg-white border border-gray-200 rounded-md shadow-sm z-10"
           data-order-form-target="agencyResults"></div>
    </div>

    <div class="mt-1 text-green-600 font-semibold text-sm"
         data-order-form-target="selectedAgency">
    </div>

    <%= f.hidden_field :agency_id, data: { order_form_target: "agencyHidden" } %>
  </div>

  <!-- üßæ Ch·ªçn s·∫£n ph·∫©m -->
  <div class="space-y-1">
    <label class="block text-gray-700 font-medium">T√¨m s·∫£n ph·∫©m</label>
    <div class="relative">
      <input type="text"
             placeholder="Nh·∫≠p t√™n ho·∫∑c m√£ s·∫£n ph·∫©m..."
             class="border border-gray-300 focus:border-blue-500 focus:ring-0 rounded-md w-full p-2 text-sm"
             data-order-form-target="productInput"
             data-action="input->order-form#searchProduct">

      <ul class="absolute left-0 right-0 mt-1 hidden bg-white border border-gray-200 rounded-md shadow-sm z-10 divide-y divide-gray-100 text-sm"
          data-order-form-target="productResults"></ul>
    </div>
  </div>

  <!-- üßÆ Danh s√°ch s·∫£n ph·∫©m -->
  <div class="space-y-2">
    <h3 class="text-base font-medium text-gray-800">Danh s√°ch s·∫£n ph·∫©m</h3>

    <ul class="border border-gray-200 rounded-md divide-y divide-gray-100 bg-white text-sm"
        data-order-form-target="selectedProducts">
      <!-- Stimulus s·∫Ω render v√†o ƒë√¢y -->
    </ul>
  </div>

  <!-- üîí Hidden nested fields -->
  <div data-order-form-target="hiddenFields">
    <% @order.ordered_products.each do |op| %>
      <%= f.fields_for :ordered_products, op do |of| %>
        <%= of.hidden_field :product_id %>
        <%= of.hidden_field :quantity %>
      <% end %>
    <% end %>
  </div>

  <!-- ‚úÖ Submit -->
  <div class="pt-4 flex justify-between border-t">
    <div class="text-bold items-center"
      data-order-form-target="orderTotal"
    >
      T·ªïng: 0
    </div>
    <%= f.submit "X√°c nh·∫≠n ƒë∆°n h√†ng",
          class: "bg-gray-800 hover:bg-gray-700 text-white px-6 py-2 rounded-md text-sm font-medium" %>
  </div>

<% end %>
